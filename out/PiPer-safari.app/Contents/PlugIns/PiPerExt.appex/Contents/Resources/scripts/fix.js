var a;a||(a=!0,(()=>{// Input 0
const LOGGING_LEVEL$$module$defines = 0;
const BROWSER$$module$defines = 0;
var module$defines = {};
module$defines.BROWSER = BROWSER$$module$defines;
module$defines.LOGGING_LEVEL = LOGGING_LEVEL$$module$defines;
// Input 1
const loggingPrefix$$module$logger = "[PiPer] ";
const LoggingLevel$$module$logger = {ALL:0, TRACE:10, INFO:20, WARNING:30, ERROR:40,};
const trace$$module$logger = LoggingLevel$$module$logger.TRACE >= LOGGING_LEVEL$$module$defines ? console.trace.bind(console) : function() {
};
const info$$module$logger = LoggingLevel$$module$logger.INFO >= LOGGING_LEVEL$$module$defines ? console.info.bind(console, loggingPrefix$$module$logger) : function() {
};
const warn$$module$logger = LoggingLevel$$module$logger.WARNING >= LOGGING_LEVEL$$module$defines ? console.warn.bind(console, loggingPrefix$$module$logger) : function() {
};
const error$$module$logger = LoggingLevel$$module$logger.ERROR >= LOGGING_LEVEL$$module$defines ? console.error.bind(console, loggingPrefix$$module$logger) : function() {
};
var module$logger = {};
module$logger.LoggingLevel = LoggingLevel$$module$logger;
module$logger.error = error$$module$logger;
module$logger.info = info$$module$logger;
module$logger.trace = trace$$module$logger;
module$logger.warn = warn$$module$logger;
// Input 2
const Browser$$module$common = {UNKNOWN:0, SAFARI:1, CHROME:2,};
const getBrowser$$module$common = function() {
  if (BROWSER$$module$defines != Browser$$module$common.UNKNOWN) {
    return BROWSER$$module$defines;
  }
  if (/Safari/.test(navigator.userAgent) && /Apple/.test(navigator.vendor)) {
    return Browser$$module$common.SAFARI;
  }
  if (/Chrome/.test(navigator.userAgent) && /Google/.test(navigator.vendor)) {
    return Browser$$module$common.CHROME;
  }
  return Browser$$module$common.UNKNOWN;
};
let PiperResource$$module$common;
let currentResource$$module$common = null;
const getResource$$module$common = function() {
  return currentResource$$module$common;
};
const setResource$$module$common = function(resource) {
  currentResource$$module$common = resource;
};
const getExtensionURL$$module$common = function(path) {
  switch(getBrowser$$module$common()) {
    case Browser$$module$common.SAFARI:
      return safari.extension.baseURI + path;
    case Browser$$module$common.CHROME:
      return chrome.runtime.getURL(path);
    case Browser$$module$common.UNKNOWN:
    default:
      return path;
  }
};
const bypassBackgroundTimerThrottling$$module$common = function() {
  if (!currentResource$$module$common.captionElement) {
    warn$$module$logger("Unnecessary bypassing of background timer throttling on page without caption support");
  }
  const request = new XMLHttpRequest();
  request.open("GET", getExtensionURL$$module$common("scripts/fix.js"));
  request.onload = function() {
    const script = document.createElement("script");
    script.setAttribute("type", "module");
    script.appendChild(document.createTextNode(request.responseText));
    document.head.appendChild(script);
  };
  request.send();
};
var module$common = {};
module$common.Browser = Browser$$module$common;
module$common.bypassBackgroundTimerThrottling = bypassBackgroundTimerThrottling$$module$common;
module$common.getBrowser = getBrowser$$module$common;
module$common.getExtensionURL = getExtensionURL$$module$common;
module$common.getResource = getResource$$module$common;
module$common.setResource = setResource$$module$common;
// Input 3
const CHROME_PLAYING_PIP_ATTRIBUTE$$module$video = "data-playing-picture-in-picture";
const eventListeners$$module$video = [];
const togglePictureInPicture$$module$video = function(video) {
  const playingPictureInPicture = videoPlayingPictureInPicture$$module$video(video);
  switch(getBrowser$$module$common()) {
    case Browser$$module$common.SAFARI:
      if (playingPictureInPicture) {
        video.webkitSetPresentationMode("inline");
      } else {
        video.webkitSetPresentationMode("picture-in-picture");
      }
      break;
    case Browser$$module$common.CHROME:
      if (playingPictureInPicture) {
        const script = document.createElement("script");
        script.textContent = "document.exitPictureInPicture()";
        document.head.appendChild(script);
        script.remove();
      } else {
        video.removeAttribute("disablepictureinpicture");
        video.requestPictureInPicture();
      }
      break;
    case Browser$$module$common.UNKNOWN:
    default:
      break;
  }
};
const addPictureInPictureEventListener$$module$video = function(listener) {
  const index = eventListeners$$module$video.indexOf(listener);
  if (index == -1) {
    eventListeners$$module$video.push(listener);
  }
  if (getBrowser$$module$common() == Browser$$module$common.SAFARI) {
    document.addEventListener("webkitpresentationmodechanged", videoPresentationModeChanged$$module$video, {capture:true,});
  }
};
const removePictureInPictureEventListener$$module$video = function(listener) {
  const index = eventListeners$$module$video.indexOf(listener);
  if (index > -1) {
    eventListeners$$module$video.splice(index, 1);
  }
  if (getBrowser$$module$common() == Browser$$module$common.SAFARI && eventListeners$$module$video.length == 0) {
    document.removeEventListener("webkitpresentationmodechanged", videoPresentationModeChanged$$module$video);
  }
};
const dispatchPictureInPictureEvent$$module$video = function(video) {
  const expectedVideo = getResource$$module$common().videoElement(true);
  if (video != expectedVideo) {
    return;
  }
  const isPlayingPictureInPicture = videoPlayingPictureInPicture$$module$video(video);
  if (isPlayingPictureInPicture) {
    info$$module$logger("Video entering Picture in Picture mode");
  } else {
    info$$module$logger("Video leaving Picture in Picture mode");
  }
  const eventListenersCopy = eventListeners$$module$video.slice();
  for (let listener; listener = eventListenersCopy.pop();) {
    listener(video, isPlayingPictureInPicture);
  }
};
const videoPresentationModeChanged$$module$video = function(event) {
  const video = event.target;
  dispatchPictureInPictureEvent$$module$video(video);
};
const videoPlayingPictureInPicture$$module$video = function(video) {
  switch(getBrowser$$module$common()) {
    case Browser$$module$common.SAFARI:
      return video.webkitPresentationMode == "picture-in-picture";
    case Browser$$module$common.CHROME:
      return video.hasAttribute(CHROME_PLAYING_PIP_ATTRIBUTE$$module$video);
    case Browser$$module$common.UNKNOWN:
    default:
      return false;
  }
};
const videoDidEnterPictureInPicture$$module$video = function(event) {
  const video = event.target;
  video.setAttribute(CHROME_PLAYING_PIP_ATTRIBUTE$$module$video, true);
  dispatchPictureInPictureEvent$$module$video(video);
  video.addEventListener("leavepictureinpicture", function(event) {
    video.removeAttribute(CHROME_PLAYING_PIP_ATTRIBUTE$$module$video);
    dispatchPictureInPictureEvent$$module$video(video);
  }, {once:true});
};
const addVideoElementListeners$$module$video = function() {
  const elements = document.getElementsByTagName("video");
  for (let index = 0, element; element = elements[index]; index++) {
    element.addEventListener("enterpictureinpicture", videoDidEnterPictureInPicture$$module$video);
  }
};
var module$video = {};
module$video.addPictureInPictureEventListener = addPictureInPictureEventListener$$module$video;
module$video.addVideoElementListeners = addVideoElementListeners$$module$video;
module$video.removePictureInPictureEventListener = removePictureInPictureEventListener$$module$video;
module$video.togglePictureInPicture = togglePictureInPicture$$module$video;
module$video.videoPlayingPictureInPicture = videoPlayingPictureInPicture$$module$video;
// Input 4
let activeVideo$$module$fix = null;
let timeoutId$$module$fix = 0;
let timeouts$$module$fix = {};
const requests$$module$fix = [];
const callbacks$$module$fix = [];
const originalSetTimeout$$module$fix = window.setTimeout;
const originalClearTimeout$$module$fix = window.clearTimeout;
const originalRequestAnimationFrame$$module$fix = window.requestAnimationFrame;
const trackAnimationFrameRequest$$module$fix = function(callback) {
  let request = 0;
  if (!activeVideo$$module$fix) {
    request = originalRequestAnimationFrame$$module$fix(callback);
    requests$$module$fix.push(request);
  }
  callbacks$$module$fix.push(callback);
  return request;
};
window.requestAnimationFrame = trackAnimationFrameRequest$$module$fix;
const clearAnimationFrameRequests$$module$fix = function() {
  requests$$module$fix.length = 0;
  callbacks$$module$fix.length = 0;
  originalRequestAnimationFrame$$module$fix(clearAnimationFrameRequests$$module$fix);
};
clearAnimationFrameRequests$$module$fix();
const callAnimationFrameRequestsAndTimeouts$$module$fix = function() {
  const callbacksCopy = callbacks$$module$fix.slice();
  callbacks$$module$fix.length = 0;
  const timestamp = window.performance.now();
  for (let callback; callback = callbacksCopy.pop();) {
    callback(timestamp);
  }
  const timeoutsCopy = timeouts$$module$fix;
  timeouts$$module$fix = {};
  for (let id in timeoutsCopy) {
    let timeout = timeoutsCopy[id];
    if (timeout[0] <= timestamp) {
      if (typeof timeout[1] == "function") {
        timeout[1]();
      } else {
        eval(timeout[1]);
      }
    } else {
      timeouts$$module$fix[id] = timeout;
    }
  }
};
const unthrottledSetTimeout$$module$fix = function(callback, timeout) {
  const id = timeoutId$$module$fix++;
  timeouts$$module$fix[id.toString()] = [window.performance.now() + (timeout || 0), callback];
  return id;
};
const unthrottledClearTimeout$$module$fix = function(id) {
  if (id) {
    delete timeouts$$module$fix[id.toString()];
  }
};
const bypassBackgroundTimerThrottling$$module$fix = function() {
  if (document.hidden) {
    const allVideos = document.querySelectorAll("video");
    for (let videoId = allVideos.length; videoId--;) {
      const video = allVideos[videoId];
      if (videoPlayingPictureInPicture$$module$video(video)) {
        activeVideo$$module$fix = video;
        break;
      }
    }
    if (!activeVideo$$module$fix) {
      return;
    }
    for (let request; request = requests$$module$fix.pop();) {
      window.cancelAnimationFrame(request);
    }
    window.setTimeout = unthrottledSetTimeout$$module$fix;
    window.clearTimeout = unthrottledClearTimeout$$module$fix;
    activeVideo$$module$fix.addEventListener("timeupdate", callAnimationFrameRequestsAndTimeouts$$module$fix);
    info$$module$logger("Bypassing background timer throttling");
  } else {
    if (activeVideo$$module$fix) {
      info$$module$logger("Finished bypassing background timer throttling");
      window.setTimeout = originalSetTimeout$$module$fix;
      window.clearTimeout = originalClearTimeout$$module$fix;
      activeVideo$$module$fix.removeEventListener("timeupdate", callAnimationFrameRequestsAndTimeouts$$module$fix);
      activeVideo$$module$fix = null;
      for (let callbackId = callbacks$$module$fix.length; callbackId--;) {
        let request = originalRequestAnimationFrame$$module$fix(callbacks$$module$fix[callbackId]);
        requests$$module$fix.push(request);
      }
      const timestamp = window.performance.now();
      for (let id in timeouts$$module$fix) {
        let timeout = timeouts$$module$fix[id];
        originalSetTimeout$$module$fix(timeout[1], timeout[0] - timestamp);
      }
      timeouts$$module$fix = {};
    }
  }
};
document.addEventListener("visibilitychange", bypassBackgroundTimerThrottling$$module$fix);
var module$fix = {};
})());
//# sourceMappingURL=data:application/json;base64,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QVN3QixDQUFBQSxnQkFBVCxDQUEwQixrQkFBMUIsRUFBOENoQywyQ0FBOUMsQ0FBQTtBQXhKQSxJQUFBcEMsYUFBQSxFQUFBOzsiLAoic291cmNlcyI6WyIuL2RlZmluZXMuanMiLCIuL2xvZ2dlci5qcyIsIi4vY29tbW9uLmpzIiwiLi92aWRlby5qcyIsIi4vZml4LmpzIl0sCiJzb3VyY2VzQ29udGVudCI6WyIvKiogQGRlZmluZSB7bnVtYmVyfSAtIEZsYWcgdXNlZCBieSBjbG9zdXJlIGNvbXBpbGVyIHRvIHNldCBsb2dnaW5nIGxldmVsICovXG5leHBvcnQgY29uc3QgTE9HR0lOR19MRVZFTCA9IDA7XG5cbi8qKiBAZGVmaW5lIHtudW1iZXJ9IC0gRmxhZyB1c2VkIGJ5IGNsb3N1cmUgY29tcGlsZXIgdG8gdGFyZ2V0IHNwZWNpZmljIGJyb3dzZXIgKi9cbmV4cG9ydCBjb25zdCBCUk9XU0VSID0gMDsiLCJpbXBvcnQgeyBMT0dHSU5HX0xFVkVMIH0gZnJvbSAnLi9kZWZpbmVzLmpzJ1xuXG5jb25zdCBsb2dnaW5nUHJlZml4ID0gJ1tQaVBlcl0gJztcblxuLyoqIEBlbnVtIHtudW1iZXJ9IC0gRW51bSBmb3IgbG9nZ2luZyBsZXZlbCAqL1xuZXhwb3J0IGNvbnN0IExvZ2dpbmdMZXZlbCA9IHtcbiAgQUxMOiAwLFxuICBUUkFDRTogMTAsXG4gIElORk86IDIwLFxuICBXQVJOSU5HOiAzMCxcbiAgRVJST1I6IDQwLFxufTtcblxuLyoqXG4gKiBMb2dzIHN0YWNrIHRyYWNlIHRvIGNvbnNvbGVcbiAqL1xuZXhwb3J0IGNvbnN0IHRyYWNlID0gKExvZ2dpbmdMZXZlbC5UUkFDRSA+PSBMT0dHSU5HX0xFVkVMKSA/IFxuICAgIGNvbnNvbGUudHJhY2UuYmluZChjb25zb2xlKSA6IGZ1bmN0aW9uKCl7fTtcblxuLyoqXG4gKiBMb2dzIGluZm9ybWF0aW9uYWwgbWVzc2FnZSB0byBjb25zb2xlXG4gKi9cbmV4cG9ydCBjb25zdCBpbmZvID0gKExvZ2dpbmdMZXZlbC5JTkZPID49IExPR0dJTkdfTEVWRUwpID8gXG4gICAgY29uc29sZS5pbmZvLmJpbmQoY29uc29sZSwgbG9nZ2luZ1ByZWZpeCkgOiBmdW5jdGlvbigpe307XG4gICAgXG4vKipcbiAqIExvZ3Mgd2FybmluZyBtZXNzYWdlIHRvIGNvbnNvbGVcbiAqL1xuZXhwb3J0IGNvbnN0IHdhcm4gPSAoTG9nZ2luZ0xldmVsLldBUk5JTkcgPj0gTE9HR0lOR19MRVZFTCkgPyBcbiAgICBjb25zb2xlLndhcm4uYmluZChjb25zb2xlLCBsb2dnaW5nUHJlZml4KSA6IGZ1bmN0aW9uKCl7fTtcbiAgICBcbi8qKlxuICogTG9ncyBlcnJvciBtZXNzYWdlIHRvIGNvbnNvbGVcbiAqL1xuZXhwb3J0IGNvbnN0IGVycm9yID0gKExvZ2dpbmdMZXZlbC5FUlJPUiA+PSBMT0dHSU5HX0xFVkVMKSA/IFxuICAgIGNvbnNvbGUuZXJyb3IuYmluZChjb25zb2xlLCBsb2dnaW5nUHJlZml4KSA6IGZ1bmN0aW9uKCl7fTsiLCJpbXBvcnQgeyBCUk9XU0VSIH0gZnJvbSAnLi9kZWZpbmVzLmpzJ1xuaW1wb3J0IHsgd2FybiB9IGZyb20gJy4vbG9nZ2VyLmpzJ1xuXG4vKiogQGVudW0ge251bWJlcn0gLSBFbnVtIGZvciBicm93c2VyICovXG5leHBvcnQgY29uc3QgQnJvd3NlciA9IHtcbiAgVU5LTk9XTjogMCxcbiAgU0FGQVJJOiAxLFxuICBDSFJPTUU6IDIsXG59O1xuXG4vKipcbiAqIFJldHVybnMgY3VycmVudCB3ZWIgYnJvd3NlclxuICpcbiAqIEByZXR1cm4ge0Jyb3dzZXJ9IFxuICovXG5leHBvcnQgY29uc3QgZ2V0QnJvd3NlciA9IGZ1bmN0aW9uKCkge1xuICBpZiAoQlJPV1NFUiAhPSBCcm93c2VyLlVOS05PV04pIHtcbiAgICByZXR1cm4gLyoqIEB0eXBlIHtCcm93c2VyfSAqLyAoQlJPV1NFUik7XG4gIH1cbiAgaWYgKC9TYWZhcmkvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgL0FwcGxlLy50ZXN0KG5hdmlnYXRvci52ZW5kb3IpKSB7XG4gICAgcmV0dXJuIEJyb3dzZXIuU0FGQVJJO1xuICB9XG4gIGlmICgvQ2hyb21lLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICYmIC9Hb29nbGUvLnRlc3QobmF2aWdhdG9yLnZlbmRvcikpIHtcbiAgICByZXR1cm4gQnJvd3Nlci5DSFJPTUU7XG4gIH1cbiAgcmV0dXJuIEJyb3dzZXIuVU5LTk9XTjtcbn07XG5cbi8qKlxuICogQHR5cGVkZWYge3tcbiAqICAgYnV0dG9uQ2xhc3NOYW1lOiAoc3RyaW5nfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvbkRpZEFwcGVhcjogKGZ1bmN0aW9uKCk6dW5kZWZpbmVkfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvbkVsZW1lbnRUeXBlOiAoc3RyaW5nfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvbkV4aXRJbWFnZTogKHN0cmluZ3x1bmRlZmluZWQpLFxuICogICBidXR0b25Ib3ZlclN0eWxlOiAoc3RyaW5nfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvbkltYWdlOiAoc3RyaW5nfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvbkluc2VydEJlZm9yZTogKGZ1bmN0aW9uKEVsZW1lbnQpOj9Ob2RlfHVuZGVmaW5lZCksXG4gKiAgIGJ1dHRvblBhcmVudDogZnVuY3Rpb24oYm9vbGVhbj0pOj9FbGVtZW50LFxuICogICBidXR0b25TY2FsZTogKG51bWJlcnx1bmRlZmluZWQpLFxuICogICBidXR0b25TdHlsZTogKHN0cmluZ3x1bmRlZmluZWQpLFxuICogICBjYXB0aW9uRWxlbWVudDogKGZ1bmN0aW9uKGJvb2xlYW49KTo/RWxlbWVudHx1bmRlZmluZWQpLFxuICogICB2aWRlb0VsZW1lbnQ6IGZ1bmN0aW9uKGJvb2xlYW49KTo/RWxlbWVudCxcbiAqIH19XG4gKi9cbmxldCBQaXBlclJlc291cmNlO1xuXG5sZXQgLyoqID9QaXBlclJlc291cmNlICovIGN1cnJlbnRSZXNvdXJjZSA9IG51bGw7XG5cbi8qKlxuICogUmV0dXJucyB0aGUgY3VycmVudCByZXNvdXJjZVxuICpcbiAqIEByZXR1cm4gez9QaXBlclJlc291cmNlfVxuICovXG5leHBvcnQgY29uc3QgZ2V0UmVzb3VyY2UgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIGN1cnJlbnRSZXNvdXJjZTtcbn07XG5cbi8qKlxuICogU2V0cyB0aGUgY3VycmVudCByZXNvdXJjZVxuICpcbiAqIEBwYXJhbSB7P1BpcGVyUmVzb3VyY2V9IHJlc291cmNlIC0gYSByZXNvdXJjZSB0byBzZXQgYXMgY3VycmVudCByZXNvdXJjZVxuICovXG5leHBvcnQgY29uc3Qgc2V0UmVzb3VyY2UgPSBmdW5jdGlvbihyZXNvdXJjZSkge1xuICBjdXJyZW50UmVzb3VyY2UgPSByZXNvdXJjZTtcbn07XG5cbi8qKlxuICogQ29udmVydHMgYSByZWxhdGl2ZSBwYXRoIHdpdGhpbiBhbiBleHRlbnNpb24gdG8gYSBmdWxseS1xdWFsaWZpZWQgVVJMXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSBhIHBhdGggdG8gYSByZXNvdXJjZVxuICogQHJldHVybiB7c3RyaW5nfSBcbiAqL1xuZXhwb3J0IGNvbnN0IGdldEV4dGVuc2lvblVSTCA9IGZ1bmN0aW9uKHBhdGgpIHtcbiAgc3dpdGNoIChnZXRCcm93c2VyKCkpIHtcbiAgICBjYXNlIEJyb3dzZXIuU0FGQVJJOlxuICAgICAgcmV0dXJuIHNhZmFyaS5leHRlbnNpb24uYmFzZVVSSSArIHBhdGg7XG4gICAgY2FzZSBCcm93c2VyLkNIUk9NRTpcbiAgICAgIHJldHVybiBjaHJvbWUucnVudGltZS5nZXRVUkwocGF0aCk7XG4gICAgY2FzZSBCcm93c2VyLlVOS05PV046XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiBwYXRoO1xuICB9XG59O1xuXG4vKipcbiAqIEFwcGxpZXMgZml4IHRvIGJ5cGFzcyBiYWNrZ3JvdW5kIERPTSB0aW1lciB0aHJvdHRsaW5nXG4gKi9cbmV4cG9ydCBjb25zdCBieXBhc3NCYWNrZ3JvdW5kVGltZXJUaHJvdHRsaW5nID0gZnVuY3Rpb24oKSB7XG5cbiAgLy8gSXNzdWUgd2FybmluZyBmb3IgdW5uZWNlc3NhcnkgdXNlIG9mIGJhY2tncm91bmQgdGltZXIgdGhyb3R0bGluZ1xuICBpZiAoIWN1cnJlbnRSZXNvdXJjZS5jYXB0aW9uRWxlbWVudCkge1xuICAgIHdhcm4oJ1VubmVjZXNzYXJ5IGJ5cGFzc2luZyBvZiBiYWNrZ3JvdW5kIHRpbWVyIHRocm90dGxpbmcgb24gcGFnZSB3aXRob3V0IGNhcHRpb24gc3VwcG9ydCcpO1xuICB9XG5cbiAgY29uc3QgcmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIGdldEV4dGVuc2lvblVSTCgnc2NyaXB0cy9maXguanMnKSk7XG4gIHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgc2NyaXB0LnNldEF0dHJpYnV0ZSgndHlwZScsICdtb2R1bGUnKTtcbiAgICBzY3JpcHQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocmVxdWVzdC5yZXNwb25zZVRleHQpKTtcbiAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gIH07XG4gIHJlcXVlc3Quc2VuZCgpO1xufTsiLCJpbXBvcnQgeyBpbmZvIH0gZnJvbSAnLi9sb2dnZXIuanMnXG5pbXBvcnQgeyBCcm93c2VyLCBnZXRCcm93c2VyLCBnZXRSZXNvdXJjZSB9IGZyb20gJy4vY29tbW9uLmpzJ1xuXG5jb25zdCBDSFJPTUVfUExBWUlOR19QSVBfQVRUUklCVVRFID0gJ2RhdGEtcGxheWluZy1waWN0dXJlLWluLXBpY3R1cmUnO1xuXG5jb25zdCAvKiogIUFycmF5PGZ1bmN0aW9uKEhUTUxWaWRlb0VsZW1lbnQsIGJvb2xlYW4pPiAqLyBldmVudExpc3RlbmVycyA9IFtdO1xuXG4vKipcbiAqIFRvZ2dsZXMgdmlkZW8gUGljdHVyZSBpbiBQaWN0dXJlXG4gKlxuICogQHBhcmFtIHtIVE1MVmlkZW9FbGVtZW50fSB2aWRlbyAtIHZpZGVvIGVsZW1lbnQgdG8gdG9nZ2xlIFBpY3R1cmUgaW4gUGljdHVyZSBtb2RlXG4gKi9cbmV4cG9ydCBjb25zdCB0b2dnbGVQaWN0dXJlSW5QaWN0dXJlID0gZnVuY3Rpb24odmlkZW8pIHtcbiAgY29uc3QgcGxheWluZ1BpY3R1cmVJblBpY3R1cmUgPSB2aWRlb1BsYXlpbmdQaWN0dXJlSW5QaWN0dXJlKHZpZGVvKTtcbiAgc3dpdGNoIChnZXRCcm93c2VyKCkpIHtcbiAgICBjYXNlIEJyb3dzZXIuU0FGQVJJOlxuICAgICAgaWYgKHBsYXlpbmdQaWN0dXJlSW5QaWN0dXJlKSB7XG4gICAgICBcdHZpZGVvLndlYmtpdFNldFByZXNlbnRhdGlvbk1vZGUoJ2lubGluZScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmlkZW8ud2Via2l0U2V0UHJlc2VudGF0aW9uTW9kZSgncGljdHVyZS1pbi1waWN0dXJlJyk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlIEJyb3dzZXIuQ0hST01FOlxuICAgICAgaWYgKHBsYXlpbmdQaWN0dXJlSW5QaWN0dXJlKSB7XG4gICAgICAgIC8vIFdvcmthcm91bmQgQ2hyb21lIGNvbnRlbnQgc2NyaXB0cyBiZWluZyB1bmFibGUgdG8gY2FsbCAnZXhpdFBpY3R1cmVJblBpY3R1cmUnIGRpcmVjdGx5XG4gICAgICAgIGNvbnN0IHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgICAgICBzY3JpcHQudGV4dENvbnRlbnQgPSAnZG9jdW1lbnQuZXhpdFBpY3R1cmVJblBpY3R1cmUoKSc7XG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbiAgICAgICAgc2NyaXB0LnJlbW92ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRm9yY2UgZW5hYmxlIFBpY3R1cmUgaW4gUGljdHVyZSBtb2RlIHN1cHBvcnRcbiAgICAgICAgdmlkZW8ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlcGljdHVyZWlucGljdHVyZScpO1xuICAgICAgICBcbiAgICAgICAgdmlkZW8ucmVxdWVzdFBpY3R1cmVJblBpY3R1cmUoKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgQnJvd3Nlci5VTktOT1dOOlxuICAgIGRlZmF1bHQ6XG4gICAgICBicmVhaztcbiAgfVxufTtcblxuLyoqXG4gKiBBZGRzIGEgUGljdHVyZSBpbiBQaWN0dXJlIGV2ZW50IGxpc3RlbmVyXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbihIVE1MVmlkZW9FbGVtZW50LCBib29sZWFuKX0gbGlzdGVuZXIgLSBhbiBldmVudCBsaXN0ZW5lciB0byBhZGRcbiAqL1xuZXhwb3J0IGNvbnN0IGFkZFBpY3R1cmVJblBpY3R1cmVFdmVudExpc3RlbmVyID0gZnVuY3Rpb24obGlzdGVuZXIpIHtcbiAgY29uc3QgaW5kZXggPSBldmVudExpc3RlbmVycy5pbmRleE9mKGxpc3RlbmVyKTtcbiAgaWYgKGluZGV4ID09IC0xKSB7XG4gICAgZXZlbnRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gIH1cblxuICBpZiAoZ2V0QnJvd3NlcigpID09IEJyb3dzZXIuU0FGQVJJKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignd2Via2l0cHJlc2VudGF0aW9ubW9kZWNoYW5nZWQnLCB2aWRlb1ByZXNlbnRhdGlvbk1vZGVDaGFuZ2VkLCB7XG4gICAgICBjYXB0dXJlOiB0cnVlLFxuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIFJlbW92ZXMgYSBQaWN0dXJlIGluIFBpY3R1cmUgZXZlbnQgbGlzdGVuZXJcbiAqXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKEhUTUxWaWRlb0VsZW1lbnQsYm9vbGVhbil9IGxpc3RlbmVyIC0gYW4gZXZlbnQgbGlzdGVuZXIgdG8gcmVtb3ZlXG4gKi9cbmV4cG9ydCBjb25zdCByZW1vdmVQaWN0dXJlSW5QaWN0dXJlRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uKGxpc3RlbmVyKSB7XG4gIGNvbnN0IGluZGV4ID0gZXZlbnRMaXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gIGlmIChpbmRleCA+IC0xKSB7XG4gICAgZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgfVxuICBcbiAgaWYgKGdldEJyb3dzZXIoKSA9PSBCcm93c2VyLlNBRkFSSSAmJiBldmVudExpc3RlbmVycy5sZW5ndGggPT0gMCkge1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3dlYmtpdHByZXNlbnRhdGlvbm1vZGVjaGFuZ2VkJywgdmlkZW9QcmVzZW50YXRpb25Nb2RlQ2hhbmdlZCk7ICAgIFxuICB9XG59O1xuXG4vKipcbiAqIERpc3BhdGNoZXMgYSBQaWN0dXJlIGluIFBpY3R1cmUgZXZlbnRcbiAqXG4gKiBAcGFyYW0ge0hUTUxWaWRlb0VsZW1lbnR9IHZpZGVvIC0gdGFyZ2V0IHZpZGVvIGVsZW1lbnRcbiAqL1xuY29uc3QgZGlzcGF0Y2hQaWN0dXJlSW5QaWN0dXJlRXZlbnQgPSBmdW5jdGlvbih2aWRlbykge1xuICBcbiAgLy8gSWdub3JlIGV2ZW50cyBmcm9tIG90aGVyIHZpZGVvIGVsZW1lbnRzIGUuZy4gYWR2ZXJ0c1xuICBjb25zdCBleHBlY3RlZFZpZGVvID0gZ2V0UmVzb3VyY2UoKS52aWRlb0VsZW1lbnQodHJ1ZSk7XG4gIGlmICh2aWRlbyAhPSBleHBlY3RlZFZpZGVvKSByZXR1cm47XG5cbiAgY29uc3QgaXNQbGF5aW5nUGljdHVyZUluUGljdHVyZSA9IHZpZGVvUGxheWluZ1BpY3R1cmVJblBpY3R1cmUodmlkZW8pO1xuICBpZiAoaXNQbGF5aW5nUGljdHVyZUluUGljdHVyZSkge1xuICAgIGluZm8oJ1ZpZGVvIGVudGVyaW5nIFBpY3R1cmUgaW4gUGljdHVyZSBtb2RlJyk7XG4gIH0gZWxzZSB7XG4gICAgaW5mbygnVmlkZW8gbGVhdmluZyBQaWN0dXJlIGluIFBpY3R1cmUgbW9kZScpO1xuICB9XG5cbiAgLy8gQ2FsbCBldmVudCBsaXN0ZW5lcnMgdXNpbmcgYSBjb3B5IHRvIHByZXZlbnQgcG9zc2libGl0eSBvZiBlbmRsZXNzIGxvb3BpbmdcbiAgY29uc3QgZXZlbnRMaXN0ZW5lcnNDb3B5ID0gZXZlbnRMaXN0ZW5lcnMuc2xpY2UoKTtcbiAgZm9yIChsZXQgbGlzdGVuZXI7IGxpc3RlbmVyID0gZXZlbnRMaXN0ZW5lcnNDb3B5LnBvcCgpOykge1xuICAgIGxpc3RlbmVyKHZpZGVvLCBpc1BsYXlpbmdQaWN0dXJlSW5QaWN0dXJlKTtcbiAgfVxufVxuXG4vKipcbiAqIERpc3BhdGNoZXMgYSBQaWN0dXJlIGluIFBpY3R1cmUgZXZlbnQgZm9yIGV2ZXJ5ICd3ZWJraXRwcmVzZW50YXRpb25tb2RlY2hhbmdlZCcgZXZlbnRcbiAqXG4gKiBAcGFyYW0geyFFdmVudH0gZXZlbnQgLSBhIHdlYmtpdHByZXNlbnRhdGlvbm1vZGVjaGFuZ2VkIGV2ZW50XG4gKi9cbmNvbnN0IHZpZGVvUHJlc2VudGF0aW9uTW9kZUNoYW5nZWQgPSBmdW5jdGlvbihldmVudCkge1xuICBjb25zdCB2aWRlbyA9ICAvKiogQHR5cGUge0hUTUxWaWRlb0VsZW1lbnR9ICovIChldmVudC50YXJnZXQpO1xuICBkaXNwYXRjaFBpY3R1cmVJblBpY3R1cmVFdmVudCh2aWRlbyk7XG59O1xuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB2aWRlbyBpcyBwbGF5aW5nIFBpY3R1cmUgaW4gUGljdHVyZVxuICpcbiAqIEBwYXJhbSB7SFRNTFZpZGVvRWxlbWVudH0gdmlkZW8gLSB2aWRlbyBlbGVtZW50IHRvIHRlc3RcbiAqIEByZXR1cm4ge2Jvb2xlYW59IFxuICovXG5leHBvcnQgY29uc3QgdmlkZW9QbGF5aW5nUGljdHVyZUluUGljdHVyZSA9IGZ1bmN0aW9uKHZpZGVvKSB7XG4gIHN3aXRjaCAoZ2V0QnJvd3NlcigpKSB7XG4gICAgY2FzZSBCcm93c2VyLlNBRkFSSTpcbiAgICAgIHJldHVybiB2aWRlby53ZWJraXRQcmVzZW50YXRpb25Nb2RlID09ICdwaWN0dXJlLWluLXBpY3R1cmUnO1xuICAgIGNhc2UgQnJvd3Nlci5DSFJPTUU6XG4gICAgICByZXR1cm4gdmlkZW8uaGFzQXR0cmlidXRlKENIUk9NRV9QTEFZSU5HX1BJUF9BVFRSSUJVVEUpO1xuICAgIGNhc2UgQnJvd3Nlci5VTktOT1dOOlxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbi8qKlxuICogU2V0cyBQaWN0dXJlIGluIFBpY3R1cmUgYXR0cmlidXRlIGFuZCB0b2dnbGVzIGNhcHRpb25zIG9uIGVudGVyaW5nIFBpY3R1cmUgaW4gUGljdHVyZSBtb2RlXG4gKlxuICogQHBhcmFtIHshRXZlbnR9IGV2ZW50IC0gYW4gZW50ZXJwaWN0dXJlaW5waWN0dXJlIGV2ZW50XG4gKi9cbmNvbnN0IHZpZGVvRGlkRW50ZXJQaWN0dXJlSW5QaWN0dXJlID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgY29uc3QgdmlkZW8gPSAvKiogQHR5cGUge0hUTUxWaWRlb0VsZW1lbnR9ICovIChldmVudC50YXJnZXQpO1xuXG4gIC8vIFNldCBwbGF5aW5nIGluIFBpY3R1cmUgaW4gUGljdHVyZSBtb2RlIGF0dHJpYnV0ZSBhbmQgZGlzcGF0Y2ggZXZlbnRcbiAgdmlkZW8uc2V0QXR0cmlidXRlKENIUk9NRV9QTEFZSU5HX1BJUF9BVFRSSUJVVEUsIHRydWUpO1xuICBkaXNwYXRjaFBpY3R1cmVJblBpY3R1cmVFdmVudCh2aWRlbyk7XG5cbiAgLy8gUmVtb3ZlIFBpY3R1cmUgaW4gUGljdHVyZSBhdHRyaWJ1dGUgYW5kIGRpc3BhdGNoIGV2ZW50IG9uIGxlYXZpbmcgUGljdHVyZSBpbiBQaWN0dXJlIG1vZGVcbiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignbGVhdmVwaWN0dXJlaW5waWN0dXJlJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICB2aWRlby5yZW1vdmVBdHRyaWJ1dGUoQ0hST01FX1BMQVlJTkdfUElQX0FUVFJJQlVURSk7XG4gICAgZGlzcGF0Y2hQaWN0dXJlSW5QaWN0dXJlRXZlbnQodmlkZW8pO1xuICB9LCB7IG9uY2U6IHRydWUgfSk7XG59O1xuXG4vKipcbiAqIEFkZHMgUGljdHVyZSBpbiBQaWN0dXJlIGV2ZW50IGxpc3RlbmVycyB0byBhbGwgdmlkZW8gZWxlbWVudHNcbiAqL1xuZXhwb3J0IGNvbnN0IGFkZFZpZGVvRWxlbWVudExpc3RlbmVycyA9IGZ1bmN0aW9uKCkge1xuICBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCd2aWRlbycpO1xuICBmb3IgKGxldCBpbmRleCA9IDAsIGVsZW1lbnQ7IGVsZW1lbnQgPSBlbGVtZW50c1tpbmRleF07IGluZGV4KyspIHtcbiAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2VudGVycGljdHVyZWlucGljdHVyZScsIHZpZGVvRGlkRW50ZXJQaWN0dXJlSW5QaWN0dXJlKTtcbiAgfVxufTtcbiIsImltcG9ydCB7IGluZm8gfSBmcm9tICcuL2xvZ2dlci5qcydcbmltcG9ydCB7IHZpZGVvUGxheWluZ1BpY3R1cmVJblBpY3R1cmUgfSBmcm9tICcuL3ZpZGVvLmpzJ1xuXG5sZXQgYWN0aXZlVmlkZW8gPSBudWxsO1xubGV0IHRpbWVvdXRJZCA9IDA7XG5sZXQgLyoqICFPYmplY3Q8c3RyaW5nLCBBcnJheT4gKi8gdGltZW91dHMgPSB7fTtcblxuY29uc3QgLyoqICFBcnJheTxudW1iZXI+ICovIHJlcXVlc3RzID0gW107XG5jb25zdCAvKiogIUFycmF5PGZ1bmN0aW9uKG51bWJlcik6IHVuZGVmaW5lZD4gKi8gY2FsbGJhY2tzID0gW107XG5cbmNvbnN0IG9yaWdpbmFsU2V0VGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0O1xuY29uc3Qgb3JpZ2luYWxDbGVhclRpbWVvdXQgPSB3aW5kb3cuY2xlYXJUaW1lb3V0O1xuY29uc3Qgb3JpZ2luYWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xuXG4vKipcbiAqIFRyYWNrcyBhbmltYXRpb24gZnJhbWUgcmVxdWVzdHMgYW5kIGZvcndhcmRzIHJlcXVlc3RzIHdoZW4gcGFnZSB2aXNpYmxlXG4gKlxuICogQHBhcmFtIHtmdW5jdGlvbihudW1iZXIpOiB1bmRlZmluZWR9IGNhbGxiYWNrIC0gYSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbGJhY2tcbiAqL1xuY29uc3QgdHJhY2tBbmltYXRpb25GcmFtZVJlcXVlc3QgPSBmdW5jdGlvbihjYWxsYmFjaykge1xuICBsZXQgcmVxdWVzdCA9IDA7XG5cbiAgaWYgKCFhY3RpdmVWaWRlbykge1xuICAgIHJlcXVlc3QgPSBvcmlnaW5hbFJlcXVlc3RBbmltYXRpb25GcmFtZShjYWxsYmFjayk7XG4gICAgcmVxdWVzdHMucHVzaChyZXF1ZXN0KTtcbiAgfVxuXG4gIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcblxuICByZXR1cm4gcmVxdWVzdDtcbn07XG53aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gdHJhY2tBbmltYXRpb25GcmFtZVJlcXVlc3Q7XG5cbi8qKlxuICogQ2xlYXJzIHRyYWNrZWQgYW5pbWF0aW9uIGZyYW1lIHJlcXVlc3RzIG9uIG5ldyBmcmFtZVxuICovXG5jb25zdCBjbGVhckFuaW1hdGlvbkZyYW1lUmVxdWVzdHMgPSBmdW5jdGlvbigpIHtcbiAgcmVxdWVzdHMubGVuZ3RoID0gMDtcbiAgY2FsbGJhY2tzLmxlbmd0aCA9IDA7XG5cbiAgb3JpZ2luYWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2xlYXJBbmltYXRpb25GcmFtZVJlcXVlc3RzKTtcbn07XG5jbGVhckFuaW1hdGlvbkZyYW1lUmVxdWVzdHMoKTtcblxuLyoqXG4gKiBDYWxscyB0cmFja2VkIGFuaW1hdGlvbiBmcmFtZSByZXF1ZXN0cyBhbmQgdGltZW91dHNcbiAqL1xuY29uc3QgY2FsbEFuaW1hdGlvbkZyYW1lUmVxdWVzdHNBbmRUaW1lb3V0cyA9IGZ1bmN0aW9uKCkge1xuICBcbiAgLy8gQ29weSBhbmltYXRpb24gZnJhbWUgY2FsbGJhY2tzIGJlZm9yZSBjYWxsaW5nIHRvIHByZXZlbnQgZW5kbGVzcyBsb29waW5nXG4gIGNvbnN0IGNhbGxiYWNrc0NvcHkgPSBjYWxsYmFja3Muc2xpY2UoKTtcbiAgY2FsbGJhY2tzLmxlbmd0aCA9IDA7XG5cbiAgLy8gQ2FsbCBhbmltYXRpb24gZnJhbWUgcmVxdWVzdHNcbiAgY29uc3QgdGltZXN0YW1wID0gd2luZG93LnBlcmZvcm1hbmNlLm5vdygpO1xuICBmb3IgKGxldCBjYWxsYmFjazsgY2FsbGJhY2sgPSBjYWxsYmFja3NDb3B5LnBvcCgpOykge1xuICAgIGNhbGxiYWNrKHRpbWVzdGFtcCk7XG4gIH1cblxuICAvLyBDb3B5IHRpbWVvdXRzIHRvIHByZXZlbnQgZW5kbGVzcyBsb29waW5nXG4gIGNvbnN0IHRpbWVvdXRzQ29weSA9IHRpbWVvdXRzO1xuICB0aW1lb3V0cyA9IHt9O1xuICBcbiAgLy8gQ2FsbCBlbGFwc2VkIHRpbWVvdXRzXG4gIGZvciAobGV0IGlkIGluIHRpbWVvdXRzQ29weSkge1xuICAgIGxldCB0aW1lb3V0ID0gdGltZW91dHNDb3B5W2lkXTtcbiAgICBpZiAodGltZW91dFswXSA8PSB0aW1lc3RhbXApIHtcbiAgICAgIGlmICh0eXBlb2YgdGltZW91dFsxXSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgdGltZW91dFsxXSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXZhbCgvKiogQHR5cGUge3N0cmluZ30gKi8gKHRpbWVvdXRbMV0pKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGltZW91dHNbaWRdID0gdGltZW91dDtcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogQXZvaWRzIGJhY2tncm91bmQgdGhyb3R0bGluZyBieSBpbnZva2luZyB0aW1lb3V0cyB3aXRoIG1lZGlhICd0aW1ldXBkYXRlJyBldmVudHNcbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufFRydXN0ZWRTY3JpcHR8c3RyaW5nfSBjYWxsYmFjayAtIGEgc2V0VGltZW91dCBjYWxsYmFja1xuICogQHBhcmFtIHtudW1iZXI9fSB0aW1lb3V0IC0gYSBkZWxheSBpbiBtc1xuICogQHJldHVybiB7bnVtYmVyfVxuICovXG5jb25zdCB1bnRocm90dGxlZFNldFRpbWVvdXQgPSBmdW5jdGlvbihjYWxsYmFjaywgdGltZW91dCkge1xuICBjb25zdCBpZCA9IHRpbWVvdXRJZCsrO1xuICB0aW1lb3V0c1tpZC50b1N0cmluZygpXSA9IFt3aW5kb3cucGVyZm9ybWFuY2Uubm93KCkgKyAodGltZW91dCB8fCAwKSwgY2FsbGJhY2tdO1xuICByZXR1cm4gaWQ7XG59O1xuXG4vKipcbiAqIENsZWFycyBxdWV1ZWQgdGltZW91dHMgdG8gYmUgaW52b2tlZCB3aXRoIG1lZGlhICd0aW1ldXBkYXRlJyBldmVudHNcbiAqXG4gKiBAcGFyYW0gez9udW1iZXJ8dW5kZWZpbmVkfSBpZCAtIGFuIGlkIHJldHVybmVkIGJ5IHVudGhyb3R0bGVkU2V0VGltZW91dFxuICovXG5jb25zdCB1bnRocm90dGxlZENsZWFyVGltZW91dCA9IGZ1bmN0aW9uKGlkKSB7XG4gIGlmIChpZCkgZGVsZXRlIHRpbWVvdXRzW2lkLnRvU3RyaW5nKCldO1xufTtcblxuLyoqXG4gKiBCeXBhc3NlcyBiYWNrZ3JvdW5kIHRpbWVyIHRocm90dGxpbmcgd2hlbiB2aWRlbyBwbGF5aW5nIHBpY3R1cmUgaW4gcGljdHVyZVxuICovXG5jb25zdCBieXBhc3NCYWNrZ3JvdW5kVGltZXJUaHJvdHRsaW5nID0gZnVuY3Rpb24oKSB7XG5cbiAgaWYgKGRvY3VtZW50LmhpZGRlbikge1xuXG4gICAgY29uc3QgYWxsVmlkZW9zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndmlkZW8nKTtcbiAgICBmb3IgKGxldCB2aWRlb0lkID0gYWxsVmlkZW9zLmxlbmd0aDsgdmlkZW9JZC0tOykge1xuICAgICAgY29uc3QgdmlkZW8gPSAvKiogQHR5cGUgez9IVE1MVmlkZW9FbGVtZW50fSAqLyAoYWxsVmlkZW9zW3ZpZGVvSWRdKTtcbiAgICAgIGlmICh2aWRlb1BsYXlpbmdQaWN0dXJlSW5QaWN0dXJlKHZpZGVvKSkge1xuICAgICAgICBhY3RpdmVWaWRlbyA9IHZpZGVvO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFhY3RpdmVWaWRlbykgcmV0dXJuO1xuICAgIFxuICAgIGZvciAobGV0IHJlcXVlc3Q7IHJlcXVlc3QgPSByZXF1ZXN0cy5wb3AoKTspIHtcbiAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZShyZXF1ZXN0KTtcbiAgICB9XG5cbiAgICB3aW5kb3cuc2V0VGltZW91dCA9IHVudGhyb3R0bGVkU2V0VGltZW91dDtcbiAgICB3aW5kb3cuY2xlYXJUaW1lb3V0ID0gdW50aHJvdHRsZWRDbGVhclRpbWVvdXQ7XG4gICAgXG4gICAgYWN0aXZlVmlkZW8uYWRkRXZlbnRMaXN0ZW5lcigndGltZXVwZGF0ZScsIGNhbGxBbmltYXRpb25GcmFtZVJlcXVlc3RzQW5kVGltZW91dHMpO1xuXG4gICAgaW5mbygnQnlwYXNzaW5nIGJhY2tncm91bmQgdGltZXIgdGhyb3R0bGluZycpO1xuXG4gIH0gZWxzZSBpZiAoYWN0aXZlVmlkZW8pIHtcblxuICAgIGluZm8oJ0ZpbmlzaGVkIGJ5cGFzc2luZyBiYWNrZ3JvdW5kIHRpbWVyIHRocm90dGxpbmcnKTtcblxuICAgIHdpbmRvdy5zZXRUaW1lb3V0ID0gb3JpZ2luYWxTZXRUaW1lb3V0O1xuICAgIHdpbmRvdy5jbGVhclRpbWVvdXQgPSBvcmlnaW5hbENsZWFyVGltZW91dDtcblxuICAgIGFjdGl2ZVZpZGVvLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCBjYWxsQW5pbWF0aW9uRnJhbWVSZXF1ZXN0c0FuZFRpbWVvdXRzKTtcblxuICAgIGFjdGl2ZVZpZGVvID0gbnVsbDtcblxuICAgIGZvciAobGV0IGNhbGxiYWNrSWQgPSBjYWxsYmFja3MubGVuZ3RoOyBjYWxsYmFja0lkLS07KSB7XG4gICAgICBsZXQgcmVxdWVzdCA9IG9yaWdpbmFsUmVxdWVzdEFuaW1hdGlvbkZyYW1lKGNhbGxiYWNrc1tjYWxsYmFja0lkXSk7XG4gICAgICByZXF1ZXN0cy5wdXNoKHJlcXVlc3QpO1xuICAgIH1cblxuICAgIGNvbnN0IHRpbWVzdGFtcCA9IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKTtcbiAgICBmb3IgKGxldCBpZCBpbiB0aW1lb3V0cykge1xuICAgICAgbGV0IHRpbWVvdXQgPSB0aW1lb3V0c1tpZF07XG4gICAgICBvcmlnaW5hbFNldFRpbWVvdXQodGltZW91dFsxXSwgdGltZW91dFswXSAtIHRpbWVzdGFtcCk7XG4gICAgfVxuICAgIHRpbWVvdXRzID0ge307XG4gIH1cbn07XG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd2aXNpYmlsaXR5Y2hhbmdlJywgYnlwYXNzQmFja2dyb3VuZFRpbWVyVGhyb3R0bGluZyk7Il0sCiJuYW1lcyI6WyJMT0dHSU5HX0xFVkVMIiwiQlJPV1NFUiIsIiRqc2NvbXAkdG1wJGV4cG9ydHMkbW9kdWxlJG5hbWUiLCJsb2dnaW5nUHJlZml4IiwiTG9nZ2luZ0xldmVsIiwiQUxMIiwiVFJBQ0UiLCJJTkZPIiwiV0FSTklORyIsIkVSUk9SIiwidHJhY2UiLCJjb25zb2xlIiwiYmluZCIsImluZm8iLCJ3YXJuIiwiZXJyb3IiLCJCcm93c2VyIiwiVU5LTk9XTiIsIlNBRkFSSSIsIkNIUk9NRSIsImdldEJyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwidmVuZG9yIiwiUGlwZXJSZXNvdXJjZSIsImN1cnJlbnRSZXNvdXJjZSIsImdldFJlc291cmNlIiwic2V0UmVzb3VyY2UiLCJyZXNvdXJjZSIsImdldEV4dGVuc2lvblVSTCIsInBhdGgiLCJzYWZhcmkiLCJleHRlbnNpb24iLCJiYXNlVVJJIiwiY2hyb21lIiwicnVudGltZSIsImdldFVSTCIsImJ5cGFzc0JhY2tncm91bmRUaW1lclRocm90dGxpbmciLCJjYXB0aW9uRWxlbWVudCIsInJlcXVlc3QiLCJYTUxIdHRwUmVxdWVzdCIsIm9wZW4iLCJvbmxvYWQiLCJyZXF1ZXN0Lm9ubG9hZCIsInNjcmlwdCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFwcGVuZENoaWxkIiwiY3JlYXRlVGV4dE5vZGUiLCJyZXNwb25zZVRleHQiLCJoZWFkIiwic2VuZCIsIkNIUk9NRV9QTEFZSU5HX1BJUF9BVFRSSUJVVEUiLCJldmVudExpc3RlbmVycyIsInRvZ2dsZVBpY3R1cmVJblBpY3R1cmUiLCJ2aWRlbyIsInBsYXlpbmdQaWN0dXJlSW5QaWN0dXJlIiwidmlkZW9QbGF5aW5nUGljdHVyZUluUGljdHVyZSIsIndlYmtpdFNldFByZXNlbnRhdGlvbk1vZGUiLCJ0ZXh0Q29udGVudCIsInJlbW92ZSIsInJlbW92ZUF0dHJpYnV0ZSIsInJlcXVlc3RQaWN0dXJlSW5QaWN0dXJlIiwiYWRkUGljdHVyZUluUGljdHVyZUV2ZW50TGlzdGVuZXIiLCJsaXN0ZW5lciIsImluZGV4IiwiaW5kZXhPZiIsInB1c2giLCJhZGRFdmVudExpc3RlbmVyIiwidmlkZW9QcmVzZW50YXRpb25Nb2RlQ2hhbmdlZCIsImNhcHR1cmUiLCJyZW1vdmVQaWN0dXJlSW5QaWN0dXJlRXZlbnRMaXN0ZW5lciIsInNwbGljZSIsImxlbmd0aCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJkaXNwYXRjaFBpY3R1cmVJblBpY3R1cmVFdmVudCIsImV4cGVjdGVkVmlkZW8iLCJ2aWRlb0VsZW1lbnQiLCJpc1BsYXlpbmdQaWN0dXJlSW5QaWN0dXJlIiwiZXZlbnRMaXN0ZW5lcnNDb3B5Iiwic2xpY2UiLCJwb3AiLCJldmVudCIsInRhcmdldCIsIndlYmtpdFByZXNlbnRhdGlvbk1vZGUiLCJoYXNBdHRyaWJ1dGUiLCJ2aWRlb0RpZEVudGVyUGljdHVyZUluUGljdHVyZSIsIm9uY2UiLCJhZGRWaWRlb0VsZW1lbnRMaXN0ZW5lcnMiLCJlbGVtZW50cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiZWxlbWVudCIsImFjdGl2ZVZpZGVvIiwidGltZW91dElkIiwidGltZW91dHMiLCJyZXF1ZXN0cyIsImNhbGxiYWNrcyIsIm9yaWdpbmFsU2V0VGltZW91dCIsIndpbmRvdyIsInNldFRpbWVvdXQiLCJvcmlnaW5hbENsZWFyVGltZW91dCIsImNsZWFyVGltZW91dCIsIm9yaWdpbmFsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwidHJhY2tBbmltYXRpb25GcmFtZVJlcXVlc3QiLCJjYWxsYmFjayIsImNsZWFyQW5pbWF0aW9uRnJhbWVSZXF1ZXN0cyIsImNhbGxBbmltYXRpb25GcmFtZVJlcXVlc3RzQW5kVGltZW91dHMiLCJjYWxsYmFja3NDb3B5IiwidGltZXN0YW1wIiwicGVyZm9ybWFuY2UiLCJub3ciLCJ0aW1lb3V0c0NvcHkiLCJpZCIsInRpbWVvdXQiLCJldmFsIiwidW50aHJvdHRsZWRTZXRUaW1lb3V0IiwidG9TdHJpbmciLCJ1bnRocm90dGxlZENsZWFyVGltZW91dCIsImhpZGRlbiIsImFsbFZpZGVvcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ2aWRlb0lkIiwiY2FuY2VsQW5pbWF0aW9uRnJhbWUiLCJjYWxsYmFja0lkIl0KfQo=
